<!DOCTYPE html>
<html>
<body>

<textarea id="myInput" rows="40" cols="120"></textarea>
<button id="myButton">执行</button>

<script>
let input = document.getElementById('myInput');
let button = document.getElementById('myButton');

const recognition = new SpeechRecognition();
recognition.lang = 'en-US'; // 设置语音识别的语言
recognition.interimResults = true; // 开启中间结果

recognition.onresult = function (event) {
  const transcript = event.results[0][0].transcript;
  // 处理语音识别结果
  window._g_ws.send(transcript);
};
  
recognition.start(); // 开始语音识别
</script>

<script>
let socket;
// 设置重连的间隔时间为 5000 毫秒
let reconnectInterval = 5000;
let pub_end_point = "ws://10.254.28.3:3030/pub"
let sub_end_point = "ws://10.254.28.3:3030/sub"
let endpoint = pub_end_point 

function connect() {
    socket = new WebSocket( endpoint );

    // 连接成功时的处理逻辑
    socket.onopen = () => {
        console.log('WebSocket Client Connected');
        window._g_ws = socket
    };

    // 接收消息时的处理逻辑
    socket.onmessage = (message) => {
        console.log('Received: ' + message.data);
    };

    // 连接关闭或连接出错时的处理逻辑
    socket.onclose = handleError;
    socket.onerror = handleError;

    function handleError(error) {
        console.log('WebSocket error: ', error);
        console.log('Reconnecting...');

        // 在一段时间后尝试重新连接
        setTimeout(connect , reconnectInterval);
    }
}

// 首次尝试连接
connect();
</script>
</body>
</html>
